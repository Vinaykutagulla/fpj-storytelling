"use strict";(()=>{var e={};e.id=263,e.ids=[263],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},6987:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>k,patchFetch:()=>y,requestAsyncStorage:()=>x,routeModule:()=>v,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var i={};t.r(i),t.d(i,{GET:()=>f,POST:()=>c});var n=t(9303),o=t(8716),a=t(670),s=t(7070),p=t(8316),l=t(3895);let d=[],u={},m={total:0,spam:0,rateLimited:0,persisted:0,fallback:0};async function c(e){try{let r=(e.headers.get("x-forwarded-for")||"").split(",")[0].trim()||"unknown",t=Date.now();if(u[r]=(u[r]||[]).filter(e=>t-e<6e4),u[r].length>=5)return m.rateLimited++,l.k.warn("rate_limited",{ip:r}),s.NextResponse.json({error:"Rate limit exceeded. Try again later."},{status:429});u[r].push(t);let i=await e.json();if(i.website)return m.spam++,l.k.warn("spam_detected",{ip:r}),s.NextResponse.json({ok:!0,id:"ignored",spam:!0},{status:200});for(let e of["name","email","institution","year","motivation"])if(!i[e]||""===String(i[e]).trim())return s.NextResponse.json({error:`Missing field: ${e}`},{status:400});if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(i.email))return s.NextResponse.json({error:"Invalid email"},{status:400});if(String(i.motivation).trim().length<40)return s.NextResponse.json({error:"Motivation too short"},{status:400});let n={id:crypto.randomUUID(),name:i.name.trim(),email:i.email.trim(),institution:i.institution.trim(),year:i.year.trim(),motivation:i.motivation.trim(),phone:i.phone?.trim()||void 0,course:i.course?.trim()||void 0,instagram:i.instagram?.trim()||void 0,linkedin:i.linkedin?.trim()||void 0,referrals:i.referrals?.trim()||void 0,referralCode:i.referralCode?.trim()||void 0,createdAt:new Date().toISOString()};if(m.total++,!p.l||!p.p)return d.push(n),l.k.info("application_created",{id:n.id,persisted:!1,referral:n.referralCode}),s.NextResponse.json({ok:!0,id:n.id,persisted:!1});{let{error:e}=await p.p.from("partner_applications").insert({id:n.id,name:n.name,email:n.email,institution:n.institution,year:n.year,motivation:n.motivation,phone:n.phone,course:n.course,instagram:n.instagram,linkedin:n.linkedin,referrals:n.referrals,referral_code:n.referralCode});if(e)return console.error("Supabase insert error",e),d.push(n),m.fallback++,l.k.error("supabase_insert_failed",{id:n.id,error:e.message}),s.NextResponse.json({ok:!0,id:n.id,persisted:!1,fallback:"memory"});return m.persisted++,l.k.info("application_created",{id:n.id,persisted:!0,referral:n.referralCode}),s.NextResponse.json({ok:!0,id:n.id,persisted:!0})}}catch(e){return s.NextResponse.json({error:"Invalid JSON"},{status:400})}}async function f(){return s.NextResponse.json({count:d.length,metrics:m})}let v=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/partner-applications/route",pathname:"/api/partner-applications",filename:"route",bundlePath:"app/api/partner-applications/route"},resolvedPagePath:"C:\\Users\\lenovo\\Documents\\fpj-storytelling\\fpj-storytelling\\next-app\\src\\app\\api\\partner-applications\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:h}=v,k="/api/partner-applications/route";function y(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},3895:(e,r,t)=>{function i(e){let r={ts:new Date().toISOString(),...e};try{console.log(JSON.stringify(r))}catch{}}t.d(r,{k:()=>n});let n={info(e,r){i({level:"info",msg:e,...r})},warn(e,r){i({level:"warn",msg:e,...r})},error(e,r){i({level:"error",msg:e,...r})}}},8316:(e,r,t)=>{t.d(r,{l:()=>a,p:()=>s});var i=t(4738);let n=process.env.SUPABASE_URL,o=process.env.SUPABASE_SERVICE_ROLE_KEY,a=!!(n&&o),s=a?(0,i.eI)(n,o,{auth:{persistSession:!1}}):null}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[948,972,738],()=>t(6987));module.exports=i})();